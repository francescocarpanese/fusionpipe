A **node** is a self-contained folder with a unique `<node_id>`, representing a processing step in your pipeline. Each node has this minimal folder sub-structure:

```
<node_id>/
├── code/
│   └── main.py
├── data/
│   └── <data files>
├── logs.txt
```

The `main.py` script is executed by the pipeline when the node runs from the UI. The `data` folder is where the output results are generated by the node are stored.

Within a node, a user needs to extract data from the parent nodes. This is achieved by using the api provided with `fusionpipe`.

The GUI allows users to create and navigate nodes.

When a node is created from the UI,the `uv init` command is automatically run. A dedicated `.venv` is created with the name of the node, and can be activated with `source .venv/bin/activate` from within the folder of the node.

## Basic User Workflow
A typical user workflow consists of the following steps:

- **Navigate the folder containig the code**
From the GUI right click and copy the path to the node. Then

```bash
cd <node_id_folder_path>
```

- **Develop the code for a given node**:

This can be done in a Jupyter notebook, Python script, or MATLAB.
Refer to `example_notebook.ipynb`, `example_script.py`, and `example_matlab.m` for examples.

For that, you can run the node a simple script. Use the API below to fetch the location of the parent folders.

- **Modify the `main.py` file**:

Include a call to your code in `main.py` you have developed in order to that to be integrated as part of the pipeline. `main.py` contains already example for that.

- **Test the node run as part of the pipeline**:
To test the node running as part of the pipeline, from the folder `<node_id>/code`, run the following command:
```bash
uv run python main.py
```
This command will first active the `.venv` dedicated for the node, and then run the python command. The `.venv` is the same that will be activated when running the node from the UI.
Make sure the `.venv` has the required dependency. See the section on integrating external python packages for more details.

- **Run the node from the pipeline UX**:

Use the pipeline UX to execute the node as part of the pipeline.

## User API
In order to get the inputs of a given node, you need to know the folder path of the parent folders.
This can be achieved within your python or matlab script using the user the following user API. See the examples in `examples` for its usage.

- `get_node_id()`

Retrieves the node ID of the current node. This is the same as the folder name of the node and follows the format `n_<datetime>_<random_4digit_integers>`.

- `get_all_parent_node_folder_paths(node_id)`

Retrieves the folder paths of all parent nodes of the current node. This provides access to the outputs of the parent nodes, located in their `data` subfolders.

- `get_folder_path_node()`

Retrieves the folder path of the current node. This is useful for saving the node's output data in its `data` subfolder.

## Setting up Jupyter Kernel for Jupyter Notebook and Jupyter lab development
If you are using Jupyter notebooks or Jupyter lab, set up a Jupyter kernel dedicated to your node.
Then activate the kernel when developing your notebook to make sure the pipeline will run with all the same dependencies.

To do that, from `<node_id>/code` folder run:
```bash
uv run python init_node_kernel.py
```
Thi command set-up a Jupyter kernel with the same name as your `node_id`, in your home folder. 

## Managing External Python Dependencies
If the Python dependencies are available as PyPI packages or locally on your system, you can add them using:
```bash
uv add <package_name>
```
This records the package requirements in the `project.toml` file and installs the package in the node's `.venv`. The package will then be available to the node when it runs as part of the pipeline.

`uv` uses caching to speed up package installation. If the package has already been installed in another node, it will not be downloaded again. This avoids duplicating large packages like `pytorch` or `tensorflow`.

If you need to add a package from a GitHub/GitLab repository, we recommend adding it as a submodule in the folder.

## Managing External MATLAB Dependencies
External MATLAB dependencies can be added to a MATLAB script by including the path to the folder containing the dependency. Add the following line at the beginning of your script:
```matlab
addpath('/path/to/your/folder');
```