

# Basic user interaction

In this section, you will learn the fundamentals of interacting with the FusionPipe frontend and how to effectively manage your data processing workflows.

<a id="pipeline-example"></a>
![Pipeline Example](../../images/pipeline_example.jpg)

Follow these simple description:

- **Create a pipeline**

First, click on `Pipeline Interaction` on the panel options shown in the [image](#pipeline-example) above and then on `Create Pipeline`.
The pipeline has unique identifier and a tag. You can select the pipeline per ids (`List ids`) or tags (`List tags`) from the dropdown menu. Remember that ids are unique, whereas tags are not necessarily.

- **Change pipeline name and add notes**

From the `Pipeline Interaction` option, select `Open selected pipeline panel` to customize the pipeline tag with a meaningful name that helps you identify the specific purpose of your pipeline. This custom tag will allow you to easily search and access your pipeline later.

Additionally, you can add detailed notes to document the pipeline's objectives, methodology, or any other relevant information for future reference.

- **Creata a node**

Click on `Node Interaction`, then on `Create node` to create a first FusionPipe node.
A node, as a pipeline, always has a unique identifier, which ensures the uniqueness of each node.
This is why a `node_id` can appear only once in a given pipeline.
The same `node_id` can be repeated in multiple pipelines as a reference to that unique node.
A node represents a folder containing three subfolders: `data`, `code` and `reports`. In `data` you will store find your node output, in `code` you will store your scripts and in `reports` you can save plots generated from your analysis. 

If you want to change the tag and add notes to your node, you only need to right click on the node, open the `Node interaction` options and select `Open selected node panel`. You will find also the possibility to add some parameters to use as fixed setting inputs to your code, only by filling the `Node Parameters (YAML)` box, which will store your parmeters in a YAML file. 

To copy the folder path of the node, right clik on a node, and select `Copy Folder Path`. Once the path is copied you can modify or add code in the node `code` folder.

- **Connect nodes**

Each node displays two connection points: an `input port` and an `output port`. These ports enable inter-node connections within your pipeline. When you create a new node and connect the `output port` of your first node to the `input port` of the second node, FusionPipe automatically establishes a parent-child relationship in its database. This relationship allows child nodes to access the output data generated by their parent nodes, creating a seamless data flow through your pipeline.

To automatically organize the nodes in your pipeline workspace, access the `Layout` menu and click `Auto reshape`. This feature arranges all nodes in an optimal layout for better visualization.

- **Delete nodes and connections**

To delete a node, click on it to ensure it is selected (the edge color will change to indicate selection). Then go to `Node interaction` (dropdown menu) and choose `Delete selected nodes` option. You can also delete multiple nodes at once by holding `Shift` and dragging with the left mouse button to select them, then using the same delete option.

To clear only a node’s outputs while preserving the node and its code, select the node and choose `Delete output selected nodes`. This action will empty the node’s `data folder`, but the node itself and its `code folder` will remain unchanged.

It is possible to delete connections between node: just select an edge which is connecting an `output port` and an `input port` and from `Node interaction` click on `Delete selected edge`. 

- **Status of the node**

A node can be in one of the following five states:

<span style="color: gray;">_Ready_</span>: The node is ready to run; its output folder is empty.

<span style="color: green;">_Completed_</span>: The node has run successfully and produced output.

<span style="color: blue;">_Running_</span>: The node is currently executing its code.

<span style="color: red;">_Failed_</span>: The node execution failed. Check the `log.txt` file in the node folder for debugging information.

<span style="color:rgb(253, 186, 3);">_Stale-data_</span>: The node’s output may be inconsistent with its code or inputs. This indicates the pipeline should be rerun to update results. See [Stale-data](#section-on-stale-data) section below.

- **Pipeline Actions**

**_Select a node and run_**: to run a node, select it and open the `Actions` panel. Then click on `Run selcted node`.  This execution will work only if the node has no parents and its `data folder` is empty, or all the parents of the node are <span style="color: green;">_completed_</span>. Now, you can go on `Layout` and select `Refresh pipeline` to see your node entering the <span style="color: blue;">_running_</span> state and finally the <span style="color: green;">_completed_</span> state.

**_Run full pipeline_**: from the `Actions` panel, select `Run full pipeline` to execute all nodes in your pipeline sequentially. FusionPipe will automatically determine the correct order based on node dependencies, ensuring that each node runs only after its parent nodes have completed. This feature streamlines the workflow, allowing you to process the entire pipeline with a single action.

**_Run pipelione up to a node_**: to execute your pipeline sequentially up to a node, select a node and from the `Actions` panel, select `Run pipeline up to selected node`.

**_Kill running node_**:  to stop the process of a node that is running, select that node, open `Actions` panel and click on `Kill run selected node`. That node will switch to <span style="color: red;">_failed_</span> sate. 

# Stale-data <a id="section-on-stale-data"></a>

A node can transition from <span style="color: green;">_completed_</span> or <span style="color: gray;">_ready_</span> to <span style="color:rgb(253, 186, 3);">_stale-data_</span> state. This can happen in the following situations:

- The user has changed the code in a node. Then it can flag the node to be in <span style="color:rgb(253, 186, 3);">_stale-data_</span> state. This way the pipeline needs to re-run the node and all its children.
- A node was in <span style="color: green;">_completed_</span> state, but then the user changed the inputs of the node.
- If there are multiple connected nodes, which are in <span style="color: green;">_completed_</span> state and you delete the output of one of these nodes. In this case, all the children nodes will switch to <span style="color:rgb(253, 186, 3);">_stale-data_</span> state.
- If you have multiple nodes, connected, which are in <span style="color: green;">_completed_</span> state and you delete the edge (connection) of a node. All the children of this edge enters the state <span style="color:rgb(253, 186, 3);">_stale-data_</span> state.
- When you duplicate a node, with data, the duplicated node by default will be in the <span style="color:rgb(253, 186, 3);">_stale-data_</span> state.


# Advanced user interaction 

- **Duplicate or reference nodes**

You can select one or more nodes with `shift + right click`. Once you have selected the desired nodes, you can duplicate them using several available options. Open the `Node interaction` panel to see three different options:

`Duplicate selected nodes in this pipeline`: this command is used to duplicate the nodes in the same pipeline. You can choose to copy the node with or without data (`Duplicate with data`, `Duplicate without data`).

`Duplicate selected nodes into another pipeline`: duplicate the node into a different pipeline (select the pipeline from the option `Select a pipeline...`) with or withou data (`Duplicate with data`, `Duplicate without data`)

`Reference selected nodes into another pipeline`: the node is not duplicated. Select the pipeline with `Select a pipeline...`, then click on `Reference nodes`. The same `node_id` is referenced in a different pipeline and the `node_id` is set in the status locked. This means that if you change the code or the data in this node, it will be changed in all the pipelines that reference this node. A lock symbol (<img src="../../images/Lock_.jpg" alt="lock" style="width: 1.3em; height: 1.3em; display: inline; vertical-align: middle;">) will appear in that node and all of its references in the other pipelines.



# Locked nodes <img src="../../images/Lock_.jpg" alt="lock" style="width: 1.2em; height: 1.2em; display: inline; vertical-align: middle;">

When a node is in "locked" status (<img src="../../images/Lock_.jpg" alt="lock" style="width: 1.3em; height: 1.3em; display: inline; vertical-align: middle;">), it indicates that this node is referenced by multiple pipelines. Any changes made to the code or data within a locked node will automatically propagate to all pipelines that reference it. This ensures consistency across pipelines, but also means that modifications can impact multiple workflows simultaneously.

In general, if you want to iterate on a node which is locked, by changing its code, you should first duplicate the "locked" node in the same pipeline, and then run the new one. Doing that, the duplicated node has a new `node_id`, and a separated folder, and you will not risk to break other pipelines. 


# Complete list of functions

- **`Project Interaction`**

Different pipelines can be grouped in a project.

`List ids`: use this option to search and select a project by its unique identifier.

`List tags`: use this option to search and select a project by its unique tag.

`Select a project`: this option displays a list of available projects, ordered by either id or tag based on your previous selection. From this list, you can choose the project you wish to open.

`Open selected project panel`: this panel allows you to change the project tag and add notes that may be useful for you and future project users.

`Create project`: select this option to create a new project.
 
`Delete project`: select this option to delete the actual project.

- **`Pipeline Interaction`**:

`List ids`: use this option to search and select a pipeline by its unique identifier.

`List tags`: use this option to search and select a pipeline by its unique tag.

`Select a pipeline`: this option displays a list of available pipelines, ordered by either id or tag based on your previous selection. From this list, you can choose the pipeline you wish to open.

`Open selected pipeline panel`: this panel allows you to change the pipeline tag and add notes that may be useful for you and future pipelines users.

`Create Pipeline`: select this option to create a new pipeline.

`Branch Pipeline from selected node`: select this option to delete the actual pipeline.

`Move Pipeline to project`: use this command to move a pipeline into a different project. Click on `Select a project`, choose the destination project, and then click `Move` to transfer the pipeline.

`Merge pipelines`: use this command to combine multiple pipelines into a single new pipeline. Click on `Select multiple pipelines`, choose the pipelines you wish to merge, and then select `Merge`. The resulting pipeline will include a unique copy of all nodes that are shared between the selected pipelines, as well as all nodes that are unique to each pipeline. This ensures that no data or workflow steps are lost during the merge process and the new pipeline provides a comprehensive view of all included nodes.

`Delete Pipeline`: select this option to delete the actual pipeline.


- **Node Interaction**:

`Open selected node panel`: this panel allows you to change the pipeline tag and add notes that may be useful for you and future pipelines users. You can fill the `Node Parameters (YAML)` box, which will store your parmeters in a YAML file to be used as fixed parameteres inputs in the node code.


`Copy selected node path to clipboard`: select a node and use this option to copy its folder path to the clipboard. Alternatively, you can right-click on the node and choose the "Copy Folder Path" option from the context menu for a quicker solution.

`Create node`:  select this option to create a new node.

`Duplicate selected nodes into this pipeline`: duplicate the selected nodes into the pipeline you are working on with or without data (`Duplicate with data`, `Duplicate without data`).

`Duplicate selected nodes into another pipeline`: duplicate the selected nodes into a different pipeline with or without data (`Duplicate with data`, `Duplicate without data`).

`Reference selected nodes into another pipeline`: reference the selected nodes into a different pipeline.

`Manual set node "completed"`: use this option to manually set the selected node to the <span style="color: green;">_completed_</span> state. This can be useful for marking a node as finished when its output is already available or when you want to bypass execution for testing or troubleshooting purposes.

`Manual set node "stale-data"`: use this option to manually set the selected node to the <span style="color:rgb(253, 186, 3);">_stale-data_</span> state. It can be useful if the user has changed the code in a node. Then it can flag the node to be in <span style="color:rgb(253, 186, 3);">_stale-data_</span> state. This way the pipeline needs to re-run the node and all its children.

`Delete output selected nodes`: use this command to clean the output data folder of a selected node.

`Delete selected edge`: use this option to delete a connection between two nodes.

`Delete selected nodes`: use this command to delete a selected node.


- **Actions**:

`Run selected node`: this function will run the code of a selected node, setting its state to <span style="color: blue;">_running_</span> state and at the end of the process to <span style="color: green;">_completed_</span> or <span style="color: red;">_failed_</span> state.

`Run full pipeline`: use this command to run the full pipeline.

`Run pipeline up to selected node`: select a node and click on this option to run the pipeline up to the selected node.

`Open run panel`: ...

`Kill run selected node`: select a node and choose this option to kill its execution.


- **Layout**:

`Refresh pipeline`: click this command to refresh the state of pipeline nodes.

`Auto reshape`: use this option to automatically arrange the nodes in your pipeline for optimal organization and improved visualization.
